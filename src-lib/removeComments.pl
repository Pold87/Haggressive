#!/usr/bin/perl -p0777
#use warnings;
#use strict;

s,("(?:[^\\"]|\\.)*"|'(?:[^\\']|\\.)*'|[^\W\d][\w']*|(?!--+(?![!#\$%&*+./<=>?\@\\^|~:]))[!#\$%&*+./<=>?\@\\^|\-~:]+)|(?:--[^\n]*|()\{-(?>\{-.*?-\}|.)*?-\})(),$+ . (defined $2 ? " " : ""),gse


Version 2:
#!/usr/bin/perl -p0777
#use warnings;
#use strict;

# s,("(?:[^\\"]|\\.)*"|'(?:[^\\']|\\.)*'|[^\W\d][\w']*|(?!--+(?![!#\$%&*+./<=>?\@\\^|~:]))[!#\$%&*+./<=>?\@\\^|\-~:]+)|(?:--[^\n]*|()\{-(?>\{-.*?-\}|.)*?-\})(),$+ . (defined $2 ? " " : ""),gse
